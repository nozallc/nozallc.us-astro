---
// LanguageToggle.astro
// Accessible language toggle component with ARIA support and keyboard navigation
---

<button
	class="language-toggle"
	id="languageToggle"
	aria-label="Switch language to Español"
	aria-pressed="false"
	aria-current="page"
	type="button"
	title="Toggle between English and Español"
>
	<span class="toggle-label" aria-hidden="true">EN</span>
	<span class="toggle-divider" aria-hidden="true">/</span>
	<span class="toggle-label secondary" aria-hidden="true">ES</span>
</button>

<style>
	.language-toggle {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 1rem;
		background: transparent;
		border: 1px solid rgba(0, 212, 255, 0.3);
		border-radius: 6px;
		color: var(--text-primary);
		font-size: 0.85rem;
		font-weight: 600;
		cursor: pointer;
		transition: all 0.3s ease;
		position: relative;
		overflow: hidden;
		white-space: nowrap;
	}

	.language-toggle::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
		transition: left 0.6s ease;
		z-index: 0;
	}

	.language-toggle:hover::before {
		left: 100%;
	}

	.language-toggle:hover {
		border-color: var(--primary-neon);
		background: rgba(0, 212, 255, 0.08);
		box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
	}

	/* Focus visible - keyboard navigation */
	.language-toggle:focus-visible {
		outline: 2px solid var(--primary-neon);
		outline-offset: 2px;
		box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
	}

	/* Active language indicator */
	.language-toggle[aria-pressed="true"] .toggle-label:first-child {
		color: var(--primary-neon);
		text-shadow: 0 0 8px rgba(0, 212, 255, 0.5);
	}

	.language-toggle[aria-pressed="false"] .toggle-label.secondary {
		color: var(--primary-neon);
		text-shadow: 0 0 8px rgba(0, 212, 255, 0.5);
	}

	.toggle-label {
		color: var(--text-secondary);
		transition: all 0.3s ease;
		position: relative;
		z-index: 1;
	}

	.toggle-divider {
		color: var(--text-secondary);
		position: relative;
		z-index: 1;
		transition: color 0.3s ease;
	}

	/* Respect reduced motion preferences */
	@media (prefers-reduced-motion: reduce) {
		.language-toggle {
			transition: none;
		}

		.language-toggle::before {
			display: none;
		}

		.language-toggle:hover::before {
			display: none;
		}

		.toggle-label,
		.toggle-divider {
			transition: none;
		}
	}

	/* Mobile responsiveness */
	@media (max-width: 480px) {
		.language-toggle {
			padding: 0.4rem 0.8rem;
			font-size: 0.8rem;
			gap: 0.35rem;
		}

		.language-toggle:focus-visible {
			outline-offset: 1px;
		}
	}
</style>

<script>
	// Client-side language toggle logic
	const toggle = document.getElementById('languageToggle');

	if (toggle) {
		// Initialize toggle state from localStorage or default to English
		const currentLang = localStorage.getItem('preferredLanguage') || 'en';
		updateToggleState(currentLang);

		// Handle click
		toggle.addEventListener('click', () => {
			const isSpanish = toggle.getAttribute('aria-pressed') === 'true';
			const newLang = isSpanish ? 'en' : 'es';
			updateToggleState(newLang);
			localStorage.setItem('preferredLanguage', newLang);

			// Announce change to screen readers
			const announcement = newLang === 'es' 
				? 'Language switched to Spanish' 
				: 'Language switched to English';
			announceToScreenReader(announcement);
		});

		// Handle keyboard (Enter and Space)
		toggle.addEventListener('keydown', (e: KeyboardEvent) => {
			if (e.key === 'Enter' || e.key === ' ') {
				e.preventDefault();
				toggle.click();
			}
		});

		// Function to update toggle state
		function updateToggleState(lang: string) {
			const isSpanish = lang === 'es';
			toggle.setAttribute('aria-pressed', isSpanish ? 'true' : 'false');

			if (isSpanish) {
				toggle.setAttribute('aria-label', 'Switch language to English');
			} else {
				toggle.setAttribute('aria-label', 'Switch language to Español');
			}

			// Store preference for use across pages
			document.documentElement.lang = lang;
			document.documentElement.setAttribute('data-lang', lang);
		}

		// Function to announce changes to screen readers (polite live region)
		function announceToScreenReader(message: string) {
			// Create or get aria-live region
			let liveRegion = document.getElementById('sr-announcement');
			if (!liveRegion) {
				liveRegion = document.createElement('div');
				liveRegion.id = 'sr-announcement';
				liveRegion.setAttribute('aria-live', 'polite');
				liveRegion.setAttribute('aria-atomic', 'true');
				liveRegion.className = 'sr-only';
				document.body.appendChild(liveRegion);
			}

			// Announce message
			liveRegion.textContent = message;

			// Clear after announcement is read
			setTimeout(() => {
				liveRegion.textContent = '';
			}, 2000);
		}
	}
</script>

<style is:global>
	/* Screen reader only text */
	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}
</style>
