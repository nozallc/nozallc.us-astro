---
// LanguageToggle.astro
// Floating language toggle with glassmorphism, landing animation, and full accessibility
---

<button
	class="floating-language-toggle"
	id="languageToggle"
	aria-label="Switch language to Español"
	aria-pressed="false"
	type="button"
	title="Toggle between English and Español"
	data-landing-animation="true"
>
	<span class="toggle-label" aria-hidden="true">EN</span>
	<span class="toggle-divider" aria-hidden="true">/</span>
	<span class="toggle-label secondary" aria-hidden="true">ES</span>
</button>

<style>
	.floating-language-toggle {
		position: fixed;
		bottom: 20px;
		right: 20px;
		z-index: 9999;
		display: flex;
		align-items: center;
		gap: 0.4rem;
		padding: 0.6rem 1rem;
		background: rgba(10, 14, 39, 0.6);
		backdrop-filter: blur(12px);
		border: 1.5px solid rgba(0, 212, 255, 0.4);
		border-radius: 12px;
		color: var(--text-primary);
		font-size: 0.8rem;
		font-weight: 600;
		cursor: pointer;
		transition: all 0.3s ease;
		overflow: hidden;
		white-space: nowrap;
		box-shadow: 0 0 12px rgba(0, 212, 255, 0.15);
	}

	/* Landing animation - subtle glow for 1-2 seconds on initial load */
	.floating-language-toggle[data-landing-animation="true"] {
		animation: landing-glow 2s ease-out forwards;
	}

	/* Shimmer effect on hover */
	.floating-language-toggle::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.15), transparent);
		transition: left 0.6s ease;
		z-index: 0;
	}

	.floating-language-toggle:hover::before {
		left: 100%;
	}

	/* Hover state */
	.floating-language-toggle:hover {
		background: rgba(10, 14, 39, 0.5);
		border-color: var(--primary-neon);
		box-shadow: 0 0 20px rgba(0, 212, 255, 0.3), inset 0 0 10px rgba(0, 212, 255, 0.05);
		transform: translateY(-2px);
	}

	/* Focus visible - keyboard navigation */
	.floating-language-toggle:focus-visible {
		outline: 2px solid var(--primary-neon);
		outline-offset: 2px;
		box-shadow: 0 0 25px rgba(0, 212, 255, 0.4), inset 0 0 10px rgba(0, 212, 255, 0.05);
	}

	/* Active language state */
	.floating-language-toggle[aria-pressed="true"] .toggle-label:first-child {
		color: var(--primary-neon);
		text-shadow: 0 0 8px rgba(0, 212, 255, 0.6);
	}

	.floating-language-toggle[aria-pressed="false"] .toggle-label.secondary {
		color: var(--primary-neon);
		text-shadow: 0 0 8px rgba(0, 212, 255, 0.6);
	}

	.toggle-label {
		color: var(--text-secondary);
		transition: all 0.3s ease;
		position: relative;
		z-index: 1;
	}

	.toggle-divider {
		color: var(--text-secondary);
		position: relative;
		z-index: 1;
		transition: color 0.3s ease;
	}

	/* Respect reduced motion preferences */
	@media (prefers-reduced-motion: reduce) {
		.floating-language-toggle[data-landing-animation="true"] {
			animation: none;
		}

		.floating-language-toggle {
			transition: none;
		}

		.floating-language-toggle::before {
			display: none;
		}

		.floating-language-toggle:hover::before {
			display: none;
		}

		.toggle-label,
		.toggle-divider {
			transition: none;
		}
	}

	/* Mobile responsiveness */
	@media (max-width: 768px) {
		.floating-language-toggle {
			bottom: 18px;
			right: 18px;
			padding: 0.5rem 0.9rem;
			font-size: 0.75rem;
			gap: 0.3rem;
		}
	}

	@media (max-width: 480px) {
		.floating-language-toggle {
			bottom: 16px;
			right: 16px;
			padding: 0.45rem 0.8rem;
			font-size: 0.7rem;
			gap: 0.25rem;
		}

		.floating-language-toggle:focus-visible {
			outline-offset: 1px;
		}
	}
</style>

<script>
	// Client-side language toggle logic with landing animation support
	const toggle = document.getElementById('languageToggle');

	if (toggle) {
		// Initialize toggle state from localStorage or default to English
		const currentLang = localStorage.getItem('preferredLanguage') || 'en';
		updateToggleState(currentLang);

		// Remove landing animation after it completes (2 seconds)
		// This ensures it only plays once on initial page load
		const animationDuration = 2000;
		setTimeout(() => {
			toggle.removeAttribute('data-landing-animation');
		}, animationDuration);

		// Handle click
		toggle.addEventListener('click', () => {
			const isSpanish = toggle.getAttribute('aria-pressed') === 'true';
			const newLang = isSpanish ? 'en' : 'es';
			updateToggleState(newLang);
			localStorage.setItem('preferredLanguage', newLang);

			// Announce change to screen readers
			const announcement = newLang === 'es'
				? 'Language switched to Spanish'
				: 'Language switched to English';
			announceToScreenReader(announcement);
		});

		// Handle keyboard (Enter and Space)
		toggle.addEventListener('keydown', (e: KeyboardEvent) => {
			if (e.key === 'Enter' || e.key === ' ') {
				e.preventDefault();
				toggle.click();
			}
		});

		// Function to update toggle state
		function updateToggleState(lang: string) {
			const isSpanish = lang === 'es';
			toggle.setAttribute('aria-pressed', isSpanish ? 'true' : 'false');

			if (isSpanish) {
				toggle.setAttribute('aria-label', 'Switch language to English');
			} else {
				toggle.setAttribute('aria-label', 'Switch language to Español');
			}

			// Store preference for use across pages
			document.documentElement.lang = lang;
			document.documentElement.setAttribute('data-lang', lang);
		}

		// Function to announce changes to screen readers (polite live region)
		function announceToScreenReader(message: string) {
			// Create or get aria-live region
			let liveRegion = document.getElementById('sr-announcement');
			if (!liveRegion) {
				liveRegion = document.createElement('div');
				liveRegion.id = 'sr-announcement';
				liveRegion.setAttribute('aria-live', 'polite');
				liveRegion.setAttribute('aria-atomic', 'true');
				liveRegion.className = 'sr-only';
				document.body.appendChild(liveRegion);
			}

			// Announce message
			liveRegion.textContent = message;

			// Clear after announcement is read
			setTimeout(() => {
				liveRegion.textContent = '';
			}, 2000);
		}
	}
</script>

<style is:global>
	/* Screen reader only text */
	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}
</style>
