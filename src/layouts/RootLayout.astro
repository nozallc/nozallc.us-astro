---
import '../styles/global.css';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import LanguageToggle from '../components/LanguageToggle.astro';

interface Props {
  title: string;
  description: string;
  lang?: string;
  alternateUrl?: string;
}

const { title, description, lang = 'en', alternateUrl } = Astro.props;

// Use production domain for canonical URLs
const productionDomain = 'https://nozallc.us';
const canonicalUrl = `${productionDomain}${Astro.url.pathname}`;
const alternateFullUrl = alternateUrl ? `${productionDomain}${alternateUrl}` : undefined;
---

<!DOCTYPE html>
<html lang={lang === 'es' ? 'es' : 'en'}>
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/NOZA.LOGO.svg" />
		<link rel="apple-touch-icon" href="/NOZA.LOGO.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<meta name="description" content={description} />
		
		<!-- Open Graph Meta Tags (Dynamic) -->
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:type" content="website" />
		<meta property="og:url" content={canonicalUrl} />
		<meta property="og:image" content="https://nozallc.us/nozallc.svg" />
		<meta property="og:image:alt" content="NOZA LLC - Performance-First Web Design & AI Agency" />
		
		<!-- Twitter Card Tags (Dynamic) -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content="https://nozallc.us/nozallc.svg" />
		
		<!-- Additional SEO Tags -->
		<meta name="theme-color" content="#0a0e27" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		
		<!-- Canonical URL -->
		<link rel="canonical" href={canonicalUrl} />

		<!-- Preconnect to critical origins -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preconnect" href="https://www.googletagmanager.com">
		<link rel="preconnect" href="https://www.google-analytics.com">
		
		<!-- DNS Prefetch for third-party resources -->
		<link rel="dns-prefetch" href="https://cdn.cloudflare.com" />
		<link rel="dns-prefetch" href="https://static.cloudflareinsights.com">

		<!-- hreflang tags for language alternates -->
		{lang === 'en' && alternateFullUrl && (
			<>
				<link rel="alternate" hreflang="en" href={canonicalUrl} />
				<link rel="alternate" hreflang="es" href={alternateFullUrl} />
			</>
		)}
		{lang === 'es' && alternateFullUrl && (
			<>
				<link rel="alternate" hreflang="es" href={canonicalUrl} />
				<link rel="alternate" hreflang="en" href={alternateFullUrl} />
			</>
		)}
		
		<!-- DNS Prefetch for CDN -->
		<link rel="dns-prefetch" href="https://cdn.cloudflare.com" />
		
		<!-- Preload critical client JS for faster hydration -->
		<link rel="preload" as="script" href="/_astro/page.B1D-nYk3.js" />
		
		<!-- Schema.org Structured Data -->
		<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "LocalBusiness",
			"name": "NOZA LLC",
			"image": "https://nozallc.us/nozallc.svg",
			"description": "Digital marketing, branding, websites & business consulting for Lexington KY small businesses",
			"address": {
				"@type": "PostalAddress",
				"addressLocality": "Lexington",
				"addressRegion": "Kentucky",
				"addressCountry": "US"
			},
			"sameAs": [
				"https://instagram.com/nozallc",
				"https://facebook.com/nozallc",
				"https://linkedin.com/company/nozallc"
			],
			"priceRange": "$$",
			"knowsAbout": ["Digital Marketing", "Web Design", "Branding", "Business Consulting"],
			"areaServed": "Lexington, Kentucky"
		}
		</script>
		
		<!-- Organization Schema -->
		<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "Organization",
			"name": "NOZA LLC",
			"url": "https://nozallc.us",
			"logo": "https://nozallc.us/nozallc.svg",
			"contact": {
				"@type": "ContactPoint",
				"telephone": "+1-859-452-8415",
				"contactType": "Business Inquiries"
			}
		}
		</script>
		<!-- Google Analytics 4 (gtag.js) - Production Only -->
		<!-- Deferred to after first user interaction to avoid LCP blocking -->
		{import.meta.env.PROD && import.meta.env.PUBLIC_GA_MEASUREMENT_ID && (
			<script define:vars={{measurementId: import.meta.env.PUBLIC_GA_MEASUREMENT_ID}}>
				// Initialize dataLayer stub immediately
				window.dataLayer = window.dataLayer || [];
				function gtag(){dataLayer.push(arguments);}
				window.gtag = gtag;
				
				// Load gtag after first user interaction or timeout
				function loadGtag() {
					const script = document.createElement('script');
					script.src = `https://www.googletagmanager.com/gtag/js?id=${window.gtagMeasurementId}`;
					script.async = true;
					document.head.appendChild(script);
					
					// Initial setup after script loads
					window.addEventListener('load', () => {
						gtag('js', new Date());
						gtag('config', window.gtagMeasurementId);
					}, { once: true });
				}
				
				// Store measurement ID for later use
				window.gtagMeasurementId = measurementId;
				
				// Load on first interaction (click, keydown, touch)
				['click', 'keydown', 'touchstart', 'scroll'].forEach(event => {
					document.addEventListener(event, loadGtag, { once: true, passive: true });
				});
				
				// Fallback: load after 3 seconds if no interaction
				setTimeout(loadGtag, 3000);
			</script>
		)}

		<!-- Enable CTA button glow effects after page renders for Lighthouse performance -->
		<script>
			// Use requestAnimationFrame twice to ensure rendering is complete
			// First frame: browser processes paint
			// Second frame: glow effects are enabled
			requestAnimationFrame(() => {
				requestAnimationFrame(() => {
					document.documentElement.classList.add('glow-ready');
				});
			});

			// Fallback for browsers with performance issues
			// Ensure glow is enabled by 100ms after DOM load
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', () => {
					setTimeout(() => {
						document.documentElement.classList.add('glow-ready');
					}, 100);
				}, { once: true });
			}
		</script>

	</head>
	<body>
		<Nav />
		<slot />
		<Footer lang={lang} />
		<LanguageToggle />
	</body>
</html>
